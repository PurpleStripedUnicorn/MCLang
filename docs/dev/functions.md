
# Function generation implementation

Unlike in C, within a function another function can be called that appears later in the script. Also, functions can accept constant parameters, which means a new Minecraft function is created for every instance calling the function with a different value for the constant parameter.

## Function manager

All MCLang functions are kept track of by the function manager, which is a part of the bytecode manager. Functions are registered as pointers to function parse nodes.

## Bytecode function stack

Bytecode functions are generated by the bytecode manager and are kept on a stack to keep track of calls to for example if-statement blocks, which each get their own function.

Aside from the bytecode function stack the bytecode manager also keeps track of all of the functions that have been removed from the bytecode function stack so these functions can then be converted to Minecraft commands later.

## Generation steps

Below all of the steps that are executed to generate functions are listed.

### Step 1: Function registration

All MCLang functions are registered, by adding a pointer to the function node to the function manager.

### Step 2: Marking first functions

For each function with return type `void` and no parameters an entry in a table belonging to this function is added with attached an empty list representing the constant values that are inserted when generating this function. A bytecode function name is reserved and put in the table along with the empty list to indicate where the generated bytecode should be put.

### Step 3: Looped function generation

For each function that still has in the table mentioned earlier, entries of functions with inserted constant values that need to be generated, the bytecode is generated.

While generating the bytecode a call may be encountered to a function with constant values inserted that has not been generated yet. For this function a new entry in its table is added indicating that this MCLang function still needs to generate bytecode. A bytecode function name is already reserved for this function to generate the function bytecode later. This name is added to the table along with the constant values inserted.

Step 3 is repeated until there are no more functions with an entry in their table.

If Step 3 is executed too many times, the program is halted and an error is shown for reaching constant parameter recursion depth.